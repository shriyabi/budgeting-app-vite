<DragDropContext onDragEnd={onDragEnd}>
        {/* FIX: Changed h-[700px] to 'h-auto lg:h-[700px]' */}
        {/* This ensures the green background grows to fit the content when stacked vertically on tablets */}
        <div className="flex bg-green-300 flex-col lg:flex-row gap-6 items-stretch h-auto lg:h-[700px]">
          
          {/* Left Div */}
          {/* Added min-h-[500px] so the scrollable list still has height on mobile/tablet */}
          <div className="flex-1 flex flex-col w-full h-full min-h-[600px] lg:min-h-0">
            
            {/* Leftover Budget Div */}
            <div className="mb-4 bg-linear-to-br from-white to-emerald-50 dark:from-gray-800 dark:to-gray-900 border border-emerald-100 dark:border-gray-700 px-8 py-6 rounded-3xl shadow-sm text-center relative overflow-hidden transition-all duration-300">
              
              <span className="text-emerald-800 dark:text-emerald-200 font-bold text-xs uppercase tracking-widest opacity-80">
                To Be Budgeted
              </span>

              <div className="mt-2 md:mb-10 lg:mb-10">
                <span className={`text-5xl font-extrabold ${
                  unallocatedFunds < 0 
                    ? 'text-rose-500 drop-shadow-sm' 
                    : 'bg-linear-to-r from-emerald-600 to-teal-500 dark:from-emerald-400 dark:to-teal-300 bg-clip-text text-transparent'
                }`}>
                    ${unallocatedFunds.toLocaleString()}
                </span>
              </div>

            </div>

            {/* Transfer Amount Div */}
            <div className="flex justify-center items-center gap-4 mb-8">
              <div className="flex items-center gap-3 bg-slate-100 dark:bg-gray-700 p-2 pl-4 rounded-full border border-slate-100 dark:border-gray-600 shadow-sm transition-colors duration-300">
                <span className="text-xs font-bold text-gray-400 dark:text-gray-400 uppercase tracking-wide">Transfer Amount</span>
                <span className="font-bold text-gray-800 dark:text-white">$</span>
                <input type="number" value={transferAmount} onChange={e => setTransferAmount(e.target.value)} className="w-16 font-bold bg-transparent focus:outline-none text-gray-800 dark:text-white" />
              </div>
              
              <Droppable droppableId="unallocated-source" isDropDisabled={true} direction="horizontal">
                  {(provided) => (
                      <div ref={provided.innerRef} {...provided.droppableProps}>
                          <Draggable draggableId="unallocated-coin-drag" index={0}>
                              {(provided, snapshot) => (
                                  <div ref={provided.innerRef} {...provided.draggableProps} {...provided.dragHandleProps} className="w-12 h-12 flex items-center justify-center border-2 border-yellow-600/20 shadow-md rounded-full cursor-grab active:cursor-grabbing hover:scale-110 transition-transform text-2xl z-20 bg-linear-to-br from-yellow-100 to-yellow-300 text-yellow-800 pointer-events-auto">
                                      ðŸª™
                                      {snapshot.isDragging && <div className="bg-emerald-600 text-white font-bold px-4 py-2 rounded-full shadow-2xl fixed z-50 pointer-events-none transform -translate-x-1/2 -translate-y-1/2">+ ${transferAmount}</div>}
                                  </div>
                              )}
                          </Draggable>
                          {provided.placeholder}
                      </div>
                  )}
              </Droppable>
            </div>
            
            {/* Category Div */}
            <div className="bg-white dark:bg-gray-800 rounded-3xl border border-gray-100 dark:border-gray-700 shadow-xs overflow-hidden flex flex-col relative h-full transition-colors duration-300">
              
              <div className="flex-1 grid grid-cols-1 grid-rows-1 overflow-y-auto p-4 smooth-scroll no-scrollbar relative min-h-0">

                <div className="col-start-1 row-start-1 z-0">
                  {items.map((item, index) => {
                    const itemColor = item.color || TAILWIND_COLORS[index % TAILWIND_COLORS.length];
                    return (
                      <div key={item.id} className="mb-3 relative group">
                        <div
                          className="min-h-[74px] py-4 pr-4 pl-3 rounded-2xl border dark:border-gray-600 flex items-center gap-3 relative shadow-xs dark:!bg-transparent"
                          style={{ backgroundColor: `${itemColor}15`, borderColor: `${itemColor}40` }}
                        >
                          <div className="w-10 h-10 flex-shrink-0"></div>

                          <span className="font-bold text-gray-700 dark:text-gray-200 text-lg leading-tight flex-1 break-words min-w-0 pr-2">
                            {item.category}
                          </span>

                          <div className="flex items-center gap-2 flex-shrink-0">
                            <div className="flex items-center bg-white/60 dark:bg-black/30 backdrop-blur-sm px-3 py-1 rounded-lg shadow-sm border border-gray-200/50 dark:border-gray-600/50">
                              <span className="text-gray-400 mr-1 text-sm">$</span>
                              <input 
                                type="number" 
                                className="w-20 text-right font-bold text-lg bg-transparent focus:outline-none focus:ring-2 focus:ring-emerald-400 dark:text-white rounded-sm" 
                                value={item.amount} 
                                onChange={(e) => handleAmountChange(index, e.target.value)} 
                              />
                            </div>
                            <button onClick={() => handleRemoveCategory(index)} className="w-8 h-8 flex items-center justify-center rounded-full text-gray-400 dark:text-gray-500 hover:bg-rose-500 hover:text-white transition-all">âœ•</button>
                          </div>
                        </div>
                      </div>
                    )
                  })}
                </div>

                <div className="col-start-1 row-start-1 z-10 pointer-events-none">
                  <Droppable droppableId="budget-list">
                    {(provided) => (
                      <div {...provided.droppableProps} ref={provided.innerRef}>
                        {items.map((item, index) => (
                          <Draggable key={item.id} draggableId={item.id} index={index}>
                            {(provided, snapshot) => (
                              <div ref={provided.innerRef} {...provided.draggableProps} className="mb-3 relative min-h-[74px] flex items-center pl-3">
                                <div
                                  {...provided.dragHandleProps}
                                  className="w-10 h-10 flex-shrink-0 flex items-center justify-center border-2 border-yellow-600/20 shadow-sm rounded-full cursor-grab active:cursor-grabbing hover:scale-110 transition-transform text-xl z-20 bg-linear-to-br from-yellow-100 to-yellow-300 text-yellow-800 pointer-events-auto"
                                >
                                  ðŸ’¸
                                </div>
                                {snapshot.isDragging && <div className="absolute top-1/2 left-14 -translate-y-1/2 bg-gray-900 text-white font-bold px-4 py-2 rounded-full shadow-xl whitespace-nowrap z-50">Move ${transferAmount}</div>}
                              </div>
                            )}
                          </Draggable>
                        ))}
                        {provided.placeholder}
                      </div>
                    )}
                  </Droppable>
                </div>
              </div>

              <div className="p-4 border-t border-gray-100 dark:border-gray-700 bg-gray-50 dark:bg-gray-700/30 flex gap-3 z-30 relative mt-auto transition-colors duration-300">
                <input className="flex-1 p-3 rounded-xl border border-gray-200 dark:border-gray-600 shadow-xs focus:outline-none focus:ring-2 focus:ring-emerald-400 bg-white dark:bg-gray-800 dark:text-white" placeholder="New Category..." value={newCategory} onChange={e => setNewCategory(e.target.value)} onKeyDown={(e) => { if (e.key === 'Enter') addNewCategory(); }} />
                <button onClick={addNewCategory} className="bg-emerald-600 hover:bg-emerald-700 text-white px-5 rounded-xl font-bold transition-all active:scale-95 text-lg">+</button>
              </div>
            </div>
          </div>

          {/* Right Div */}
          <div className="flex-1 w-full lg:w-auto h-full flex flex-col">
            <div className="bg-white dark:bg-gray-800 p-8 rounded-3xl shadow-lg border border-gray-100 dark:border-gray-700 flex flex-col h-full justify-between transition-colors duration-300">
              <h3 className="text-gray-400 font-bold uppercase tracking-widest text-xs mb-8 text-center">Funds Allocation</h3>
              
              <div className="w-full h-[70%] min-h-[300px]">
                <ResponsiveContainer width="100%" height="100%">
                  <PieChart>
                    <Pie
                      data={items}
                      dataKey="amount"
                      nameKey="category"
                      innerRadius="50%"
                      outerRadius="75%" 
                      paddingAngle={5}
                      cornerRadius={6}
                    >
                      {items.map((entry, index) => (
                        <Cell
                          key={`cell-${index}`}
                          fill={entry.color || TAILWIND_COLORS[index % TAILWIND_COLORS.length]}
                          stroke="none"
                        />
                      ))}
                    </Pie>
                    <Tooltip formatter={(val) => `$${val.toLocaleString()}`} contentStyle={{ borderRadius: '12px', border: 'none', boxShadow: '0 10px 15px -3px rgba(0, 0, 0, 0.1)' }} />
                    <Legend verticalAlign="bottom" height={36} iconType="circle" wrapperStyle={{ paddingTop: "20px" }}/>
                  </PieChart>
                </ResponsiveContainer>
              </div>
              
              <button
                onClick={saveBudget}
                className="w-full py-4 bg-gray-900 hover:bg-black dark:bg-emerald-800 dark:hover:bg-emerald-700 text-white text-lg font-bold rounded-2xl shadow-xl mt-6 transition-all active:scale-[0.98]"
              >
                ðŸ’¾ Save All Changes
              </button>
            </div>
          </div>

        </div>
      </DragDropContext>