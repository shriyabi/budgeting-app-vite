
   const loadBudget = async () => {
    if (!spreadsheetInput) return setSpreadsheetStatus("⚠️ Enter Link");
    if (!sheetName) return setSpreadsheetStatus("⚠️ Select a Sheet Name");

    const realId = getSpreadsheetId(spreadsheetInput);
    setSpreadsheetStatus("⏳ Syncing...");

    try {
      const url = `${API_URL}?spreadsheetId=${realId}&sheetName=${sheetName}`;
      const res = await fetch(url);
      const text = await res.text();

      if (text.trim().startsWith("<")) {
        throw new Error("Script Permissions Error");
      }

      const json = JSON.parse(text);

      if (json.allSheets) setAvailableSheets(json.allSheets);

      // update vars
      if (json.savedData) {
        setSalary(json.savedData.salary);
        setBonus(json.savedData.bonus);
        setStateCode(json.savedData.state);
      }

      if (json.status === "empty") {
        setItems([
          { id: '1', category: 'Rent', amount: 0, color: TAILWIND_COLORS[0] },
          { id: '2', category: 'Groceries', amount: 0, color: TAILWIND_COLORS[1] }
        ]);
        setSpreadsheetStatus("✨ New Budget Ready");
      } else if (json.status === "error") {
        throw new Error(json.message);
      } else {
        setItems((json.items || []).map((i, idx) => ({
          ...i,
          id: `item-${idx}`,
          color: i.color || TAILWIND_COLORS[idx % TAILWIND_COLORS.length]
        })));
        setSpreadsheetStatus("✅ Data Synced");
      }

    } catch (e) {
      console.error(e);
      setSpreadsheetStatus(`❌ Error: ${e.message}`);
    }
  };

  const saveBudget = async () => {
    const realId = getSpreadsheetId(spreadsheetInput);

    // Save budget colors pop up
    const shouldSyncDesign = window.confirm(
      "Do you want to apply your category colors to the Google Sheet?"
    );

    setSpreadsheetStatus("⏳ Saving...");
    try {
      const res = await fetch(API_URL, {
        method: "POST",
        body: JSON.stringify({
          spreadsheetId: realId,
          sheetName: sheetName.trim() || "MyBudget",
          netMonthlyIncome,
          incomeData: { salary, bonus, state: stateCode },
          items,
          syncDesign: shouldSyncDesign
        })
      });
      const json = await res.json();
      if (json.allSheets) setAvailableSheets(json.allSheets);
      setSpreadsheetStatus("✅ Saved!");
    } catch (e) {
      setSpreadsheetStatus(`❌ Error: ${e.message}`);
    }
  };